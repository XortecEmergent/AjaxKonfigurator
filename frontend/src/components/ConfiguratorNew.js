import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card';\nimport { Button } from './ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from './ui/tabs';\nimport { Badge } from './ui/badge';\nimport { Progress } from './ui/progress';\nimport { ArrowRight, ArrowLeft, Settings, ShoppingCart, Download, CheckCircle2, Info, Zap, Shield, Wifi, Plus, Minus, AlertCircle, FileSpreadsheet } from 'lucide-react';\nimport StepNavigation from './StepNavigation';\nimport ColorSelector from './ColorSelector';\nimport AccessoryModal from './AccessoryModal';\nimport { downloadExcel } from '../utils/excelExport';\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nconst ConfiguratorNew = ({ onShowImpressum }) => {\n  // State Management\n  const [currentStep, setCurrentStep] = useState(1);\n  const [productLines, setProductLines] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [products, setProducts] = useState([]);\n  const [selectedProductLine, setSelectedProductLine] = useState('');\n  const [selectedHub, setSelectedHub] = useState(null);\n  const [selectedNVR, setSelectedNVR] = useState(null);\n  const [selectedCategory, setSelectedCategory] = useState('');\n  const [selectedProducts, setSelectedProducts] = useState([]);\n  const [productQuantities, setProductQuantities] = useState({});\n  const [showAccessoryModal, setShowAccessoryModal] = useState(false);\n  const [selectedProductForAccessories, setSelectedProductForAccessories] = useState(null);\n  const [selectedAccessories, setSelectedAccessories] = useState({});\n  const [productColors, setProductColors] = useState({});\n  const [hubQuantities, setHubQuantities] = useState({});\n  const [nvrQuantities, setNvrQuantities] = useState({});\n\n  const steps = [\n    { number: 1, title: 'Produktlinie' },\n    { number: 2, title: selectedProductLine === 'video' ? 'NVR auswählen' : 'Hub auswählen' },\n    { number: 3, title: 'Komponenten' },\n    { number: 4, title: 'Zusammenfassung' }\n  ];\n\n  // API Functions\n  const fetchProductLines = async () => {\n    try {\n      const response = await axios.get(`${API}/product-lines`);\n      setProductLines(response.data.product_lines || []);\n    } catch (error) {\n      console.error('Error fetching product lines:', error);\n    }\n  };\n\n  const fetchCategories = async (productLine = null) => {\n    try {\n      const url = productLine ? `${API}/categories?product_line=${productLine}` : `${API}/categories`;\n      const response = await axios.get(url);\n      setCategories(response.data.categories || []);\n    } catch (error) {\n      console.error('Error fetching categories:', error);\n    }\n  };\n\n  const fetchProducts = async (productLine = '', category = '') => {\n    try {\n      const params = new URLSearchParams();\n      if (productLine) params.append('product_line', productLine);\n      if (category) params.append('category', category);\n      \n      const response = await axios.get(`${API}/products?${params.toString()}`);\n      setProducts(Array.isArray(response.data) ? response.data : []);\n    } catch (error) {\n      console.error('Error fetching products:', error);\n      setProducts([]);\n    }\n  };\n\n  const fetchHubs = async (productLine = '') => {\n    try {\n      const params = new URLSearchParams();\n      if (productLine) params.append('product_line', productLine);\n      params.append('category', 'hubs');\n      \n      const response = await axios.get(`${API}/products?${params.toString()}`);\n      const hubs = Array.isArray(response.data) ? response.data : [];\n      setProducts(hubs);\n    } catch (error) {\n      console.error('Error fetching hubs:', error);\n      setProducts([]);\n    }\n  };\n\n  const fetchNVRs = async () => {\n    try {\n      const response = await axios.get(`${API}/products?product_line=video&category=nvrs`);\n      const nvrs = Array.isArray(response.data) ? response.data : [];\n      setProducts(nvrs);\n    } catch (error) {\n      console.error('Error fetching NVRs:', error);\n      setProducts([]);\n    }\n  };\n\n  // Step Navigation\n  const nextStep = () => {\n    if (currentStep < steps.length) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStep > 1) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const goToStep = (stepNumber) => {\n    setCurrentStep(stepNumber);\n  };\n\n  // Product Line Selection\n  const selectProductLine = (productLine) => {\n    setSelectedProductLine(productLine.id);\n    setSelectedHub(null);\n    setSelectedNVR(null);\n    setSelectedCategory('');\n    setSelectedProducts([]);\n    fetchCategories(productLine.id);\n    nextStep();\n  };\n\n  // Hub/NVR Selection\n  const selectHub = (hub) => {\n    setSelectedHub(hub);\n    setHubQuantities({ [hub.id]: 1 });\n    nextStep();\n  };\n\n  const selectNVR = (nvr) => {\n    setSelectedNVR(nvr);\n    setNvrQuantities({ [nvr.id]: 1 });\n    nextStep();\n  };\n\n  // Product Selection\n  const toggleProduct = (product) => {\n    const isSelected = selectedProducts.some(p => p.id === product.id);\n    if (isSelected) {\n      setSelectedProducts(selectedProducts.filter(p => p.id !== product.id));\n      setProductQuantities(prev => {\n        const updated = { ...prev };\n        delete updated[product.id];\n        return updated;\n      });\n    } else {\n      setSelectedProducts([...selectedProducts, product]);\n      setProductQuantities(prev => ({ ...prev, [product.id]: 1 }));\n    }\n  };\n\n  const updateQuantity = (productId, delta) => {\n    setProductQuantities(prev => {\n      const currentQuantity = prev[productId] || 1;\n      const newQuantity = Math.max(1, currentQuantity + delta);\n      return { ...prev, [productId]: newQuantity };\n    });\n  };\n\n  const updateHubQuantity = (hubId, delta) => {\n    setHubQuantities(prev => {\n      const currentQuantity = prev[hubId] || 1;\n      const newQuantity = Math.max(1, currentQuantity + delta);\n      return { ...prev, [hubId]: newQuantity };\n    });\n  };\n\n  const updateNVRQuantity = (nvrId, delta) => {\n    setNvrQuantities(prev => {\n      const currentQuantity = prev[nvrId] || 1;\n      const newQuantity = Math.max(1, currentQuantity + delta);\n      return { ...prev, [nvrId]: newQuantity };\n    });\n  };\n\n  // Capacity Calculations\n  const calculateTotalNVRCapacity = () => {\n    if (!selectedNVR) return 0;\n    const nvrQuantity = nvrQuantities[selectedNVR.id] || 1;\n    const capacityPerNVR = selectedNVR.name.includes('16') ? 16 : 8;\n    return capacityPerNVR * nvrQuantity;\n  };\n\n  const calculateUsedCameraCapacity = () => {\n    return selectedProducts\n      .filter(product => product.category === 'cameras' || product.category === 'wifi_cameras')\n      .reduce((total, product) => total + (productQuantities[product.id] || 1), 0);\n  };\n\n  // Effects\n  useEffect(() => {\n    fetchProductLines();\n    fetchCategories();\n  }, []);\n\n  useEffect(() => {\n    if (selectedProductLine && currentStep === 2) {\n      if (selectedProductLine === 'video') {\n        fetchNVRs();\n      } else {\n        fetchHubs(selectedProductLine);\n      }\n    }\n  }, [selectedProductLine, currentStep]);\n\n  useEffect(() => {\n    if (selectedCategory && selectedProductLine) {\n      fetchProducts(selectedProductLine, selectedCategory);\n    }\n  }, [selectedCategory, selectedProductLine]);\n\n  // Export Functions\n  const handleExport = async () => {\n    try {\n      const configData = {\n        productLine: selectedProductLine,\n        hub: selectedHub,\n        nvr: selectedNVR,\n        products: selectedProducts,\n        quantities: productQuantities,\n        hubQuantities,\n        nvrQuantities,\n        accessories: selectedAccessories,\n        colors: productColors\n      };\n      await downloadExcel(configData);\n    } catch (error) {\n      console.error('Export error:', error);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-white\">\n      {/* Header */}\n      <div className=\"bg-white/95 backdrop-blur-sm border-b border-gray-100 sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-4\">\n            <div className=\"flex items-center space-x-8\">\n              <img\n                src=\"https://xortec.de/media/image/c6/55/58/xortec_logo_ohne_zusatz200x34.png\"\n                alt=\"Xortec GmbH\"\n                className=\"h-8\"\n              />\n              <div className=\"hidden md:flex items-center space-x-2\">\n                <span className=\"text-gray-400\">×</span>\n                <img\n                  src=\"https://ajax.systems/assets/img/logo/ajax-logo.svg\"\n                  alt=\"Ajax Systems\"\n                  className=\"h-6 filter brightness-0\"\n                />\n              </div>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <Button \n                variant=\"ghost\" \n                onClick={onShowImpressum}\n                className=\"text-gray-600 hover:text-gray-900\"\n              >\n                Impressum\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Step Navigation */}\n      <div className=\"bg-white border-b border-gray-100\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <StepNavigation \n            steps={steps} \n            currentStep={currentStep} \n            onStepClick={goToStep}\n            productLine={selectedProductLine}\n          />\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Step 1: Product Line Selection */}\n        {currentStep === 1 && (\n          <div className=\"space-y-8\">\n            <div className=\"text-center\">\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">Produktlinie wählen</h2>\n              <p className=\"text-lg text-gray-600 max-w-3xl mx-auto\">\n                Ajax Systems bietet verschiedene Produktlinien für unterschiedliche Sicherheitsanforderungen\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {productLines.map((line) => (\n                <Card \n                  key={line.id} \n                  className=\"group cursor-pointer hover:shadow-xl transition-all duration-300 border-gray-200 hover:border-black bg-white overflow-hidden\"\n                  onClick={() => selectProductLine(line)}\n                >\n                  <div className=\"aspect-video overflow-hidden\">\n                    <img \n                      src={line.image_url} \n                      alt={line.name}\n                      className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\n                      onError={(e) => {\n                        e.target.style.display = 'none';\n                      }}\n                    />\n                  </div>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-xl font-bold text-gray-900 group-hover:text-black\">\n                      {line.name}\n                    </CardTitle>\n                    <CardDescription className=\"text-sm text-gray-600\">\n                      {line.target_group}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-gray-700 text-sm mb-4\">{line.description}</p>\n                    <div className=\"flex flex-wrap gap-1 mb-4\">\n                      {line.features.slice(0, 3).map((feature, idx) => (\n                        <Badge key={idx} variant=\"secondary\" className=\"text-xs px-2 py-1\">\n                          {feature}\n                        </Badge>\n                      ))}\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-500\">Auswählen</span>\n                      <ArrowRight className=\"h-4 w-4 text-gray-400 group-hover:text-black transition-colors\" />\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Step 2: Hub/NVR Selection */}\n        {currentStep === 2 && (\n          <div className=\"space-y-8\">\n            <div className=\"text-center\">\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">\n                {selectedProductLine === 'video' ? 'NVR auswählen' : 'Hub auswählen'}\n              </h2>\n              <p className=\"text-lg text-gray-600\">\n                {selectedProductLine === 'video' \n                  ? 'Netzwerk-Videorekorder für Ihre Kamera-Installation'\n                  : 'Die Zentrale Ihres Ajax Security Systems'\n                }\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {products.map((product) => (\n                <Card \n                  key={product.id} \n                  className={`group cursor-pointer transition-all duration-300 border-gray-200 hover:border-black hover:shadow-lg ${\n                    (selectedProductLine === 'video' ? selectedNVR : selectedHub)?.id === product.id \n                      ? 'ring-2 ring-black border-black shadow-lg' \n                      : ''\n                  }`}\n                  onClick={() => selectedProductLine === 'video' ? selectNVR(product) : selectHub(product)}\n                >\n                  <div className=\"aspect-square p-6 bg-gray-50 group-hover:bg-gray-100 transition-colors\">\n                    <img \n                      src={product.image_url} \n                      alt={product.name}\n                      className=\"w-full h-full object-contain\"\n                      onError={(e) => {\n                        e.target.style.display = 'none';\n                      }}\n                    />\n                  </div>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                      {product.name}\n                    </CardTitle>\n                    <CardDescription className=\"text-sm text-gray-600\">\n                      {product.short_description}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex flex-wrap gap-1 mb-4\">\n                      {product.usps.slice(0, 4).map((usp, idx) => (\n                        <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                          {usp}\n                        </Badge>\n                      ))}\n                    </div>\n                    <p className=\"text-sm text-gray-700 line-clamp-2\">\n                      {product.description}\n                    </p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n            <div className=\"flex justify-between\">\n              <Button onClick={prevStep} variant=\"outline\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Zurück\n              </Button>\n              \n              {((selectedProductLine === 'video' && selectedNVR) || \n                (selectedProductLine !== 'video' && selectedHub)) && (\n                <Button onClick={nextStep}>\n                  Weiter\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Step 3: Component Selection */}\n        {currentStep === 3 && (\n          <div className=\"space-y-8\">\n            <div className=\"text-center\">\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">Komponenten auswählen</h2>\n              <p className=\"text-lg text-gray-600\">\n                Wählen Sie die gewünschten Sicherheitskomponenten für Ihr System\n              </p>\n            </div>\n\n            {/* Category Tabs */}\n            <Tabs value={selectedCategory} onValueChange={setSelectedCategory}>\n              <TabsList className=\"grid w-full grid-cols-2 md:grid-cols-4 bg-gray-100\">\n                {categories.map((category) => (\n                  <TabsTrigger \n                    key={category.id} \n                    value={category.id}\n                    className=\"data-[state=active]:bg-white data-[state=active]:text-black font-medium\"\n                  >\n                    {category.name}\n                  </TabsTrigger>\n                ))}\n              </TabsList>\n\n              {categories.map((category) => (\n                <TabsContent key={category.id} value={category.id} className=\"mt-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                    {products.map((product) => {\n                      const isSelected = selectedProducts.some(p => p.id === product.id);\n                      const quantity = productQuantities[product.id] || 1;\n                      \n                      return (\n                        <Card \n                          key={product.id} \n                          className={`group transition-all duration-300 border-gray-200 hover:shadow-lg ${\n                            isSelected ? 'ring-2 ring-black border-black shadow-lg' : 'hover:border-gray-300'\n                          }`}\n                        >\n                          <div className=\"aspect-square p-4 bg-gray-50 group-hover:bg-gray-100 transition-colors\">\n                            <img \n                              src={product.image_url} \n                              alt={product.name}\n                              className=\"w-full h-full object-contain\"\n                              onError={(e) => {\n                                e.target.style.display = 'none';\n                              }}\n                            />\n                          </div>\n                          <CardHeader className=\"pb-2\">\n                            <CardTitle className=\"text-lg font-semibold text-gray-900\">\n                              {product.name}\n                            </CardTitle>\n                            <CardDescription className=\"text-sm text-gray-600\">\n                              {product.short_description}\n                            </CardDescription>\n                          </CardHeader>\n                          <CardContent className=\"space-y-4\">\n                            <div className=\"flex flex-wrap gap-1\">\n                              {product.usps.slice(0, 3).map((usp, idx) => (\n                                <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                                  {usp}\n                                </Badge>\n                              ))}\n                            </div>\n                            \n                            <div className=\"flex items-center justify-between\">\n                              <Button\n                                onClick={() => toggleProduct(product)}\n                                variant={isSelected ? \"default\" : \"outline\"}\n                                size=\"sm\"\n                                className={isSelected ? \"bg-black hover:bg-gray-800\" : \"\"}\n                              >\n                                {isSelected ? (\n                                  <>\n                                    <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                                    Ausgewählt\n                                  </>\n                                ) : (\n                                  <>\n                                    <Plus className=\"h-4 w-4 mr-2\" />\n                                    Hinzufügen\n                                  </>\n                                )}\n                              </Button>\n                              \n                              {isSelected && (\n                                <div className=\"flex items-center space-x-2\">\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"outline\"\n                                    onClick={() => updateQuantity(product.id, -1)}\n                                  >\n                                    <Minus className=\"h-4 w-4\" />\n                                  </Button>\n                                  <span className=\"font-medium min-w-[2rem] text-center\">{quantity}</span>\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"outline\"\n                                    onClick={() => updateQuantity(product.id, 1)}\n                                  >\n                                    <Plus className=\"h-4 w-4\" />\n                                  </Button>\n                                </div>\n                              )}\n                            </div>\n                          </CardContent>\n                        </Card>\n                      );\n                    })}\n                  </div>\n                </TabsContent>\n              ))}\n            </Tabs>\n\n            <div className=\"flex justify-between\">\n              <Button onClick={prevStep} variant=\"outline\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Zurück\n              </Button>\n              \n              <Button onClick={nextStep} className=\"bg-black hover:bg-gray-800\">\n                Zur Zusammenfassung\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Step 4: Summary */}\n        {currentStep === 4 && (\n          <div className=\"space-y-8\">\n            <div className=\"text-center\">\n              <h2 className=\"text-3xl font-bold text-gray-900 mb-4\">System-Zusammenfassung</h2>\n              <p className=\"text-lg text-gray-600\">\n                Übersicht Ihrer Ajax Security System-Konfiguration\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              {/* System Configuration */}\n              <div className=\"lg:col-span-2 space-y-6\">\n                {/* Product Line */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg font-semibold\">Gewählte Produktlinie</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex items-center space-x-3\">\n                      <Badge variant=\"default\" className=\"bg-black text-white\">\n                        {productLines.find(pl => pl.id === selectedProductLine)?.name}\n                      </Badge>\n                      <span className=\"text-sm text-gray-600\">\n                        {productLines.find(pl => pl.id === selectedProductLine)?.target_group}\n                      </span>\n                    </div>\n                  </CardContent>\n                </Card>\n\n                {/* Hub/NVR */}\n                {(selectedHub || selectedNVR) && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg font-semibold\">\n                        {selectedProductLine === 'video' ? 'Network Video Recorder' : 'System Hub'}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"flex items-start space-x-4\">\n                        <img \n                          src={(selectedHub || selectedNVR)?.image_url} \n                          alt={(selectedHub || selectedNVR)?.name}\n                          className=\"w-16 h-16 object-contain bg-gray-50 rounded p-2\"\n                          onError={(e) => e.target.style.display = 'none'}\n                        />\n                        <div className=\"flex-1\">\n                          <h4 className=\"font-medium text-gray-900\">{(selectedHub || selectedNVR)?.name}</h4>\n                          <p className=\"text-sm text-gray-600\">{(selectedHub || selectedNVR)?.short_description}</p>\n                          <div className=\"flex items-center space-x-2 mt-2\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => selectedProductLine === 'video' \n                                ? updateNVRQuantity(selectedNVR.id, -1)\n                                : updateHubQuantity(selectedHub.id, -1)\n                              }\n                            >\n                              <Minus className=\"h-4 w-4\" />\n                            </Button>\n                            <span className=\"font-medium min-w-[2rem] text-center\">\n                              {selectedProductLine === 'video' \n                                ? (nvrQuantities[selectedNVR?.id] || 1)\n                                : (hubQuantities[selectedHub?.id] || 1)\n                              }\n                            </span>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => selectedProductLine === 'video' \n                                ? updateNVRQuantity(selectedNVR.id, 1)\n                                : updateHubQuantity(selectedHub.id, 1)\n                              }\n                            >\n                              <Plus className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* NVR Capacity Status for Video Line */}\n                {selectedProductLine === 'video' && selectedNVR && (\n                  <Card className=\"bg-blue-50 border-blue-200\">\n                    <CardHeader>\n                      <CardTitle className=\"text-lg font-semibold flex items-center\">\n                        <Info className=\"h-5 w-5 mr-2 text-blue-600\" />\n                        Kamera-Kapazität\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex justify-between items-center\">\n                          <span>Verfügbare Kamera-Kanäle:</span>\n                          <span className=\"font-medium\">{calculateTotalNVRCapacity()}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                          <span>Verwendete Kamera-Kanäle:</span>\n                          <span className=\"font-medium\">{calculateUsedCameraCapacity()}</span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                          <span>Freie Kanäle:</span>\n                          <span className=\"font-medium\">{calculateTotalNVRCapacity() - calculateUsedCameraCapacity()}</span>\n                        </div>\n                        <Progress \n                          value={(calculateUsedCameraCapacity() / calculateTotalNVRCapacity()) * 100} \n                          className=\"h-2\"\n                        />\n                        {calculateUsedCameraCapacity() > calculateTotalNVRCapacity() && (\n                          <div className=\"flex items-center space-x-2 text-red-600\">\n                            <AlertCircle className=\"h-4 w-4\" />\n                            <span className=\"text-sm\">Warnung: Kamera-Kapazität überschritten!</span>\n                          </div>\n                        )}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Selected Components */}\n                {selectedProducts.length > 0 && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg font-semibold\">Ausgewählte Komponenten</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-4\">\n                        {selectedProducts.map((product) => (\n                          <div key={product.id} className=\"flex items-start space-x-4 p-3 bg-gray-50 rounded-lg\">\n                            <img \n                              src={product.image_url} \n                              alt={product.name}\n                              className=\"w-12 h-12 object-contain bg-white rounded p-1\"\n                              onError={(e) => e.target.style.display = 'none'}\n                            />\n                            <div className=\"flex-1\">\n                              <h4 className=\"font-medium text-gray-900\">{product.name}</h4>\n                              <p className=\"text-sm text-gray-600\">{product.short_description}</p>\n                              <div className=\"flex flex-wrap gap-1 mt-1\">\n                                {product.usps.slice(0, 2).map((usp, idx) => (\n                                  <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\n                                    {usp}\n                                  </Badge>\n                                ))}\n                              </div>\n                            </div>\n                            <div className=\"text-right\">\n                              <div className=\"font-medium text-gray-900\">× {productQuantities[product.id] || 1}</div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n              </div>\n\n              {/* Actions */}\n              <div className=\"space-y-6\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg font-semibold\">Aktionen</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    <Button \n                      onClick={handleExport} \n                      className=\"w-full bg-black hover:bg-gray-800\"\n                    >\n                      <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n                      Excel exportieren\n                    </Button>\n                    \n                    <Button \n                      onClick={() => setCurrentStep(1)} \n                      variant=\"outline\"\n                      className=\"w-full\"\n                    >\n                      <Settings className=\"h-4 w-4 mr-2\" />\n                      Neue Konfiguration\n                    </Button>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"bg-gray-50\">\n                  <CardHeader>\n                    <CardTitle className=\"text-lg font-semibold\">Nächste Schritte</CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"text-sm text-gray-600 space-y-2\">\n                    <p>• Exportieren Sie Ihre Konfiguration</p>\n                    <p>• Kontaktieren Sie Xortec für ein Angebot</p>\n                    <p>• Professionelle Installation durch zertifizierte Techniker</p>\n                  </CardContent>\n                </Card>\n              </div>\n            </div>\n\n            <div className=\"flex justify-between\">\n              <Button onClick={prevStep} variant=\"outline\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Zurück\n              </Button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Modals */}\n      {showAccessoryModal && (\n        <AccessoryModal\n          product={selectedProductForAccessories}\n          isOpen={showAccessoryModal}\n          onClose={() => {\n            setShowAccessoryModal(false);\n            setSelectedProductForAccessories(null);\n          }}\n          selectedAccessories={selectedAccessories}\n          onAccessoryChange={setSelectedAccessories}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ConfiguratorNew;"